(executable
 (public_name capitalcommander)
 (name main)
 (libraries capitalcommander dream)
 (preprocess (pps lwt_ppx)))

(rule
 (targets error.ml)
  (deps error.eml.ml)
   (action (run dream_eml %{deps} --workspace %{workspace_root})))

(rule
 (targets base.ml)
  (deps base.eml.html)
   (action (run dream_eml %{deps} --workspace %{workspace_root})))

(rule
 (targets version.ml)
  (deps version.eml.html)
   (action (run dream_eml %{deps} --workspace %{workspace_root})))

(rule
 (targets account.ml)
  (deps account.eml.html)
   (action (run dream_eml %{deps} --workspace %{workspace_root})))

(rule
 (target assets.ml)
 (deps (source_tree assets))
 (action (with-stdout-to %{null}
  (run ocaml-crunch -m plain assets -o %{target}))))